Initializing Financial Data Ingestor...
Building FAISS index for semantic validation...

âœ“ Ingestor ready!

================================================================================
RUNNING EXAMPLE QUERIES
================================================================================


EXAMPLE 1/1
--------------------------------------------------------------------------------
================================================================================
INGESTING: i want the income statement for coca cola yearly.
================================================================================

[1/5] Analyzing query with LLM...
  âœ“ Proceed: True
  âœ“ Features:
    - Native: []
    - Enrichment: []
  âœ“ Semantic Keywords: ['fundamentals', 'income_statement', 'annual', 'stock', 'financial']
  âœ“ LLM selected 2 endpoint(s):
    - alpha_vantage.INCOME_STATEMENT
    - polygon.get_aggs

[2/5] Building execution plan...
  âœ“ Created 2 request(s)

[3/5] Validating endpoints semantically (FAISS)...
  Validating with keywords: ['fundamentals', 'income_statement', 'annual', 'stock', 'financial']
  âš  alpha_vantage.INCOME_STATEMENT: score=0.64, status=WARNING
  âš  polygon.get_aggs: score=0.35, status=WARNING

[4/5] Validating parameters...
      Warning: Low semantic match (0.64, threshold: 0.7)
      Warning: Very low semantic match (0.35, threshold: 0.7)

[5/5] Executing API calls...
  â†’ Calling alpha_vantage.INCOME_STATEMENT
  âœ“ Success: 20 rows Ã— 28 columns
  â†’ Calling polygon.get_aggs
  âœ“ Success: 22 rows Ã— 10 columns
  âœ“ Status: COMPLETE
  âœ“ Successful: 2

================================================================================
COMPLETED in 19845ms
Returned 2 dataset(s)

Validation Reports:
  1. alpha_vantage.INCOME_STATEMENT âœ“ PASSED
     Ticker: KO
     Found: []
  2. polygon.get_aggs âœ“ PASSED
     Ticker: KO
     Found: []

Enrichment features: []
Key features (query intent): ['KO', 'fundamentals', 'income_statement', 'annual', 'stock', 'financial']
================================================================================


ðŸ“Š RESULTS:

Enrichment Features: []
Key Features (Query Intent): ['KO', 'fundamentals', 'income_statement', 'annual', 'stock', 'financial']

ðŸ”§ LLM Parameter Selections:

  Request 1:
    API: alpha_vantage
    Endpoint: INCOME_STATEMENT
    Parameters:
      - symbol: KO
      - period: annual
    Reasoning: Alpha Vantage income statement for KO with annual period (yearly data)

  Request 2:
    API: polygon
    Endpoint: get_aggs
    Parameters:
      - ticker: KO
      - multiplier: 1
      - timespan: day
      - from: 2025-10-23
      - to: 2025-11-22
    Reasoning: Polygon daily aggregates for KO to provide price context alongside fundamentals

ðŸ“‹ Validation Reports:

  Report 1: âœ“ PASSED
    API: alpha_vantage
    Endpoint: INCOME_STATEMENT
    Ticker: KO
    Found features: []
    Actual columns: ['ticker', 'timestamp', 'reportedCurrency', 'income_statement_grossProfit', 'income_statement_totalRevenue', 'income_statement_costOfRevenue', 'income_statement_costofGoodsAndServicesSold', 'income_statement_operatingIncome', 'income_statement_sellingGeneralAndAdministrative', 'income_statement_researchAndDevelopment', 'income_statement_operatingExpenses', 'income_statement_investmentIncomeNet', 'income_statement_netInterestIncome', 'income_statement_interestIncome', 'income_statement_interestExpense', 'income_statement_nonInterestIncome', 'income_statement_otherNonOperatingIncome', 'income_statement_depreciation', 'income_statement_depreciationAndAmortization', 'income_statement_incomeBeforeTax', 'income_statement_incomeTaxExpense', 'income_statement_interestAndDebtExpense', 'income_statement_netIncomeFromContinuingOperations', 'income_statement_comprehensiveIncomeNetOfTax', 'income_statement_ebit', 'income_statement_ebitda', 'income_statement_netIncome', 'period']

  Report 2: âœ“ PASSED
    API: polygon
    Endpoint: get_aggs
    Ticker: KO
    Found features: []
    Actual columns: ['ticker', 'open', 'high', 'low', 'close', 'volume', 'vwap', 'timestamp', 'transactions', 'otc']

ðŸ“ˆ DataFrames:

  Dataset 1:
    Shape: (20, 28)
    Columns: ['ticker', 'timestamp', 'reportedCurrency', 'income_statement_grossProfit', 'income_statement_totalRevenue', 'income_statement_costOfRevenue', 'income_statement_costofGoodsAndServicesSold', 'income_statement_operatingIncome', 'income_statement_sellingGeneralAndAdministrative', 'income_statement_researchAndDevelopment', 'income_statement_operatingExpenses', 'income_statement_investmentIncomeNet', 'income_statement_netInterestIncome', 'income_statement_interestIncome', 'income_statement_interestExpense', 'income_statement_nonInterestIncome', 'income_statement_otherNonOperatingIncome', 'income_statement_depreciation', 'income_statement_depreciationAndAmortization', 'income_statement_incomeBeforeTax', 'income_statement_incomeTaxExpense', 'income_statement_interestAndDebtExpense', 'income_statement_netIncomeFromContinuingOperations', 'income_statement_comprehensiveIncomeNetOfTax', 'income_statement_ebit', 'income_statement_ebitda', 'income_statement_netIncome', 'period']

    First 5 rows:
   ticker   timestamp reportedCurrency  income_statement_grossProfit  income_statement_totalRevenue  income_statement_costOfRevenue  income_statement_costofGoodsAndServicesSold  income_statement_operatingIncome  income_statement_sellingGeneralAndAdministrative  income_statement_researchAndDevelopment  income_statement_operatingExpenses  income_statement_investmentIncomeNet  income_statement_netInterestIncome  income_statement_interestIncome  income_statement_interestExpense  income_statement_nonInterestIncome  income_statement_otherNonOperatingIncome  income_statement_depreciation  income_statement_depreciationAndAmortization  income_statement_incomeBeforeTax  income_statement_incomeTaxExpense  income_statement_interestAndDebtExpense  income_statement_netIncomeFromContinuingOperations  income_statement_comprehensiveIncomeNetOfTax  income_statement_ebit  income_statement_ebitda  income_statement_netIncome  period
0      KO  2005-12-31              USD                   14909000000                    23104000000                      8195000000                                   8195000000                        6085000000                                        8824000000                                      NaN                          8824000000                                   NaN                                 NaN                              NaN                                 0                                 NaN                                       NaN                            NaN                                     932000000                        6690000000                         1818000000                                      NaN                                                 NaN                                           NaN             6085000000               7017000000                  4872000000  annual
1      KO  2006-12-31              USD                   15924000000                    24088000000                      8164000000                                   8164000000                        6308000000                                        9616000000                                      NaN                          9616000000                                   NaN                                 NaN                              NaN                                 0                                 NaN                                       NaN                            NaN                                     938000000                        6578000000                         1498000000                                      NaN                                                 NaN                                           NaN             6308000000               7246000000                  5080000000  annual
2      KO  2007-12-31              USD                   18451000000                    28857000000                     10406000000                                  10406000000                        7252000000                                       11199000000                                      NaN                         11199000000                                   NaN                                 NaN                              NaN                         456000000                                 NaN                                       NaN                            NaN                                    1163000000                        7873000000                         1892000000                                      NaN                                                 NaN                                           NaN             8329000000               9492000000                  5981000000  annual
3      KO  2008-12-31              USD                   20570000000                    31944000000                     11374000000                                  11374000000                        8446000000                                       11774000000                                      NaN                         12124000000                                   NaN                                 NaN                              NaN                         438000000                                 NaN                                       NaN                            NaN                                    1228000000                        7506000000                         1632000000                                      NaN                                                 NaN                                           NaN             7944000000               9172000000                  5807000000  annual
4      KO  2009-12-31              USD                   19902000000                    30990000000                     11088000000                                  11088000000                        8231000000                                       11358000000                                      0.0                         11671000000                                   NaN                                 NaN                              NaN                         355000000                                 NaN                              1.070000e+09                            NaN                                    1236000000                        8946000000                         2040000000                                      NaN                                        6.906000e+09                                           NaN             9301000000              10537000000                  6824000000  annual
5      KO  2010-12-31              USD                   22426000000                    35119000000                     12693000000                                  12693000000                        8413000000                                         380000000                                      0.0                         14013000000                                   NaN                                 NaN                              NaN                         733000000                                 NaN                              6.527000e+09                            NaN                                    1443000000                       14207000000                         2370000000                                      NaN                                        1.185900e+10                                           NaN            14940000000              16383000000                 11787000000  annual
6      KO  2011-12-31              USD                   28327000000                    46542000000                     18215000000                                  18215000000                       10173000000                                         354000000                                      0.0                         18154000000                                   NaN                                 NaN                              NaN                         417000000                                 NaN                              1.702000e+09                            NaN                                    1954000000                       11458000000                         2812000000                                      NaN                                        8.634000e+09                                           NaN            11875000000              13829000000                  8584000000  annual
7      KO  2012-12-31              USD                   28964000000                    48017000000                     19053000000                                  19053000000                       10779000000                                         259000000                                      0.0                         18185000000                                   NaN                                 NaN                              NaN                         397000000                                 NaN                              1.427000e+09                            NaN                                    1982000000                       11809000000                         2723000000                                      NaN                                        9.086000e+09                                           NaN            12206000000              14188000000                  9019000000  annual
8      KO  2013-12-31              USD                   28433000000                    46854000000                     18421000000                                  18421000000                       10228000000                                         227000000                                      0.0                         18205000000                                   NaN                                 NaN                              NaN                         463000000                                 NaN                              1.712000e+09                            NaN                                    1977000000                       11477000000                         2851000000                                      NaN                                        8.626000e+09                                           NaN            11940000000              13917000000                  8584000000  annual
9      KO  2014-12-31              USD                   28109000000                    45998000000                     17889000000                                  17889000000                        9708000000                                       13719000000                                      0.0                         18401000000                                   NaN                                 NaN                              NaN                         483000000                                 NaN                              1.000000e+08                            NaN                                    1976000000                        9325000000                         2201000000                                      NaN                                        7.124000e+09                                           NaN             9808000000              11784000000                  7098000000  annual
10     KO  2015-12-31              USD                   26812000000                    44294000000                     17482000000                                  17482000000                        8728000000                                       12451000000                                      0.0                         18084000000                                   NaN                                 NaN                     2.031000e+09                         856000000                                 NaN                              1.733000e+09                            NaN                                    1970000000                        9605000000                         2239000000                                      NaN                                        7.366000e+09                                           NaN            10461000000              12431000000                  7351000000  annual
11     KO  2016-12-31              USD                   25398000000                    41863000000                     16465000000                                  16465000000                        8657000000                                       11397000000                                      0.0                         16741000000                                   NaN                       -9.100000e+07                     6.420000e+08                         733000000                                 NaN                              2.430000e+08                            NaN                                    1787000000                        8136000000                         1586000000                                      NaN                                        6.550000e+09                                           NaN             8869000000              10656000000                  6527000000  annual
12     KO  2017-12-31              USD                   22491000000                    36212000000                     13721000000                                  13721000000                        7755000000                                        8943000000                                      0.0                         14736000000                                   NaN                       -1.640000e+08                     6.770000e+08                         853000000                                 NaN                              8.200000e+07                            NaN                                    1260000000                        6890000000                         5607000000                                      NaN                                        1.182000e+09                                           NaN             7743000000               9003000000                  1248000000  annual
13     KO  2018-12-31              USD                   21233000000                    34300000000                     13067000000                                  13067000000                        9152000000                                        7013000000                                      0.0                         12081000000                                   NaN                       -2.370000e+08                     6.820000e+08                         950000000                                 NaN                              5.690000e+08                            NaN                                    1086000000                        8225000000                         1749000000                                      NaN                                        6.727000e+09                                           NaN             9175000000              10261000000                  6434000000  annual
14     KO  2019-12-31              USD                   22647000000                    37266000000                     14619000000                                  14619000000                       10086000000                                        8005000000                                      NaN                         12561000000                                   NaN                       -3.830000e+08                     5.630000e+08                         946000000                                 NaN                              1.646000e+09                            NaN                                    1365000000                       10786000000                         1801000000                                      NaN                                        8.985000e+09                                           NaN            11732000000              13097000000                  8920000000  annual
15     KO  2020-12-31              USD                   19581000000                    33014000000                     13433000000                                  13433000000                        8997000000                                        6563000000                                      NaN                         10584000000                                   NaN                       -1.067000e+09                     8.900000e+07                        1437000000                                 NaN                              2.189000e+09                            NaN                                    1536000000                        9749000000                         1981000000                                      NaN                                        7.768000e+09                                           NaN            11186000000              12722000000                  7747000000  annual
16     KO  2021-12-31              USD                   23298000000                    38655000000                     15357000000                                  15357000000                       10308000000                                        7865000000                                      NaN                         12990000000                                   NaN                       -1.321000e+09                     2.760000e+08                        1597000000                                 NaN                              3.714000e+09                            NaN                                    1452000000                       12425000000                         2621000000                                      NaN                                        9.804000e+09                                           NaN            14022000000              15474000000                  9771000000  annual
17     KO  2022-12-31              USD                   25004000000                    43004000000                     18000000000                                  18000000000                       10909000000                                        8665000000                                      NaN                         14095000000                                   NaN                       -4.330000e+08                     1.039000e+09                         882000000                                 NaN                              1.659000e+09                            NaN                                    1260000000                       11686000000                         2115000000                                      NaN                                        9.571000e+09                                           NaN            12568000000              13828000000                  9542000000  annual
18     KO  2023-12-31              USD                   27234000000                    45754000000                     18520000000                                  18520000000                       11311000000                                        8978000000                                      NaN                         15923000000                                   NaN                       -6.350000e+08                     9.070000e+08                        1527000000                                 NaN                                       NaN                            NaN                                    1128000000                       12952000000                         2249000000                                      NaN                                        1.070300e+10                                           NaN            14479000000              15607000000                 10714000000  annual
19     KO  2024-12-31              USD                   28737000000                    47061000000                     18324000000                                  18324000000                        9992000000                                        9296000000                                      NaN                         18745000000                                   NaN                       -6.680000e+08                     9.880000e+08                        1656000000                                 NaN                                       NaN                            NaN                                    1075000000                       13086000000                         2437000000                                      NaN                                        1.064900e+10                                           NaN            14742000000              15817000000                 10631000000  annual

  Dataset 2:
    Shape: (22, 10)
    Columns: ['ticker', 'open', 'high', 'low', 'close', 'volume', 'vwap', 'timestamp', 'transactions', 'otc']

    First 5 rows:
   ticker    open     high      low  close      volume     vwap   timestamp  transactions   otc
0      KO  70.810  70.9287  69.7200  69.94  13989414.0  70.0758  2025-10-23        204518  None
1      KO  69.910  70.0500  69.6450  69.71  15681626.0  69.8351  2025-10-24        214754  None
2      KO  69.780  70.1150  69.2500  70.06  13789921.0  69.7291  2025-10-27        227466  None
3      KO  70.045  70.9000  69.9500  70.16  12730493.0  70.3671  2025-10-28        206916  None
4      KO  69.920  70.0300  68.1550  68.35  19789610.0  68.5779  2025-10-29        280036  None
5      KO  68.450  69.2900  68.3872  68.98  14741624.0  68.9700  2025-10-30        217367  None
6      KO  68.545  69.0700  67.9001  68.90  16728207.0  68.7492  2025-10-31        223147  None
7      KO  68.800  68.8900  67.6600  67.97  15641500.0  67.9829  2025-11-03        290744  None
8      KO  68.470  68.7300  68.1600  68.66  12743781.0  68.5044  2025-11-04        211875  None
9      KO  68.660  68.8300  68.1750  68.51  12850125.0  68.4618  2025-11-05        193193  None
10     KO  68.300  69.1350  67.9200  69.06  15906651.0  68.7969  2025-11-06        227165  None
11     KO  69.810  70.8700  69.4100  70.55  25097480.0  70.4475  2025-11-07        308716  None
12     KO  70.010  70.6600  69.4400  70.52  15311385.0  70.1429  2025-11-10        237915  None
13     KO  70.980  71.7500  70.6600  71.61  16160212.0  71.3852  2025-11-11        239778  None
14     KO  71.490  71.8900  71.3400  71.51  13604628.0  71.6521  2025-11-12        212885  None
15     KO  71.415  71.6675  71.0000  71.07  13988172.0  71.2733  2025-11-13        211738  None
16     KO  71.405  71.6400  70.6000  71.16  13160779.0  71.0115  2025-11-14        201089  None
17     KO  71.200  71.5250  70.6200  70.68  14755361.0  70.9276  2025-11-17        212969  None
18     KO  70.990  71.3400  70.5700  71.22  12815025.0  71.0898  2025-11-18        209161  None
19     KO  71.200  71.4450  70.8143  71.11  12382754.0  71.1558  2025-11-19        204013  None
20     KO  70.950  71.4800  70.6100  71.21  15372799.0  71.0955  2025-11-20        239469  None
21     KO  71.680  73.1900  71.4850  72.95  26447238.0  72.7514  2025-11-21        312514  None

================================================================================


================================================================================
USAGE GUIDE
================================================================================

You can now use the ingestor with any custom query:

  proceed, dataframes, enrichment, key_features, reports = ingestor.process('your query here')

Examples:
  â€¢ proceed, dataframes, enrichment, key_features, reports = ingestor.process('Get IBM daily prices')
  â€¢ proceed, dataframes, enrichment, key_features, reports = ingestor.process('Show GDP data')
  â€¢ proceed, dataframes, enrichment, key_features, reports = ingestor.process('Apple with SMA_20')

The function returns:
  1. proceed: Boolean flag indicating if the query was finance-related
  2. dataframes: List of pandas DataFrames with the data
  3. enrichment_features: List of technical indicators (e.g., ['SMA_20', 'RSI_14'])
  4. key_features: List modeling query intent (tickers + keywords + enrichment)
  5. validation_reports: List of ValidationReport objects

Default behaviors:
  â€¢ Non-finance queries return empty results (proceed=false)
  â€¢ Vague stock queries without ticker â†’ Polygon FULL_MARKET_SNAPSHOT
  â€¢ Vague stock queries with ticker â†’ 1-month daily data from both APIs
  â€¢ Vague economic queries â†’ Polygon INFLATION + Alpha Vantage CPI
  â€¢ All timestamps are date-only (no time component)

================================================================================
